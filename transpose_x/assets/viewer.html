<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>OSMD Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/opensheetmusicdisplay@1.7.6/build/opensheetmusicdisplay.min.js"></script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      overflow: auto;
      background-color: white;
    }

    #osmd-container {
      width: 100%;
      margin: 0;
    }
  </style>
</head>

<body>
  <div id="osmd-container"></div>
  <script>
    const osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("osmd-container", {
      autoResize: true,
    });

    function loadXml(xml) {
      osmd.load(xml).then(() => {
        osmd.render();

        // After render, try to remove title text
        const svg = document.querySelector("#osmd-container svg");
        if (svg) {
          const texts = svg.querySelectorAll("text");
          texts.forEach((textNode) => {
            const content = textNode.textContent?.trim().toLowerCase();
            if (content === "untitled score" || content.includes("untitled")) {
              textNode.remove();
            }
          });
        }
      });
    }

    window.addEventListener("message", (event) => {
      if (event.data && event.data.type === "loadXml") {
        console.log("ðŸŽ¼ Received XML from Flutter!");
        console.log(event.data.xml?.slice(0, 100));
        loadXml(event.data.xml);
      }
    });
  </script>
</body>

</html>